<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Seth Green" />


<title>Getting Started with bbr</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Getting Started with bbr</h1>
<h4 class="author">Seth Green</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This “Getting Started with bbr” vignette takes the user through some basic scenarios for modeling with NONMEM using <code>bbr</code>, introducing you to its standard workflow and functionality.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<p><code>bbr</code> is an R interface for running <code>bbi</code>. Together they provide a solution for managing projects involving modeling and simulation with a number of software solutions used in pharmaceutical sciences. Currently, only NONMEM is supported, so this vignette will only address that.</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<div id="installing-bbi" class="section level2">
<h2>Installing bbi</h2>
<p>The <em>first time</em> you use <code>bbr</code> on a system or disk, you must first install <code>bbi</code>.</p>
<div id="setting-bbi_exe_path" class="section level3">
<h3>Setting bbi_exe_path</h3>
<p>The <code>bbi</code> executable is a single binary file, you just need to tell <code>bbr</code> where to find it. This can be done by setting the <code>bbr.bbi_exe_path</code> option like so:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&quot;bbr.bbi_exe_path&quot;</span> <span class="ot">=</span> <span class="st">&quot;/data/apps/bbi&quot;</span>)</span></code></pre></div>
<p>Please note that <strong>this must be set for every new R session, so it’s recommended to include the above snippet in your .Rprofile</strong>, replacing the <code>&quot;/data/apps/bbi&quot;</code> with the absolute path from your system/project, if you have installed it somewhere different.</p>
<p>Also note that this can be pointed to anywhere on your system; installing to <code>/data/apps/bbi</code> is merely a convention used at Metrum Research Group, where <code>bbr</code> was developed.</p>
</div>
<div id="installing-with-use_bbi" class="section level3">
<h3>Installing with <code>use_bbi()</code></h3>
<p><code>bbr</code> provides an installer function named <code>use_bbi()</code> that makes it easy to install <code>bbi</code> from within R.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>bbr<span class="sc">::</span><span class="fu">use_bbi</span>()</span></code></pre></div>
<p>With no arguments passed, <code>use_bbi()</code> will default to installing <code>bbi</code> at the path you have set in <code>options(&quot;bbr.bbi_exe_path&quot;)</code>. This is why we recommend setting this first (and putting it in your <code>.Rprofile</code> so that it is sourced for every new R session). If this option is <em>not</em> set, <code>use_bbi()</code> will fall back to the <code>bbi</code> in my <code>$PATH</code> (accessed via <code>Sys.which(&quot;bbi&quot;)</code>) and then an OS-dependent default, in that order. See <code>?use_bbi()</code> if you would like more details.</p>
<p>The <code>use_bbi()</code> function also optionally takes the <em>absolute path</em> where you want to install <code>bbi</code>, though we recommend most users to follow the pattern above: first specifying a path in <code>options(&quot;bbr.bbi_exe_path&quot;)</code>, and then letting <code>use_bbi()</code> install to that path by default.</p>
</div>
<div id="updating-bbi-or-checking-if-its-installed" class="section level3">
<h3>Updating bbi or checking if it’s installed</h3>
<p>If you’re not sure if you have <code>bbi</code> installed, you can use <code>bbi_version()</code> to check. This will return the version number of your installation, if one is found, or an empty string if you do <em>not</em> have <code>bbi</code> installed. You can also use <code>bbi_current_release()</code> to see the most current version available and run <code>use_bbi()</code> as specified above if you want to update.</p>
<p>You can also check the <a href="https://github.com/metrumresearchgroup/bbi">bbi documentation</a> for manual installation instructions from the command line.</p>
</div>
</div>
<div id="bbi.yaml-configuration-file" class="section level2">
<h2>bbi.yaml configuration file</h2>
<p>To actually submit models with <code>bbi</code>, you will also need a <code>bbi.yaml</code> configuration file. Think of this as containing “global default settings” for your <code>bbi</code> runs. Those settings will not be discussed here, but know that they can be modified globally by editing that file, or model-by-model as described in the “Passing arguments to bbi” section below.</p>
<div id="bbi_init" class="section level3">
<h3>bbi_init()</h3>
<p>The <code>bbi_init()</code> function will create a <code>bbi.yaml</code>, with the default settings, in the specified directory. Optionally, you can pass the path to a <code>bbi.yaml</code> to the <code>.config_path</code> argument of any <code>bbr</code> function that needs one. However, by default these functions will look for one in the same folder as the model being submitted or manipulated. Therefore, if you will have a number of models in the same folder, it is easiest to put a <code>bbi.yaml</code> that folder.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>MODEL_DIR <span class="ot">&lt;-</span> <span class="st">&quot;../model/nonmem/basic&quot;</span>  <span class="co"># this should be relative to your working directory</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bbi_init</span>(<span class="at">.dir =</span> MODEL_DIR,            <span class="co"># the directory to create the bbi.yaml in</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.nonmem_dir =</span> <span class="st">&quot;/opt/NONMEM&quot;</span>, <span class="co"># location of NONMEM installation</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">.nonmem_version =</span> <span class="st">&quot;nm74gf&quot;</span>)  <span class="co"># default NONMEM version to use</span></span></code></pre></div>
<p>Here we define a define variable <code>MODEL_DIR</code> with the path to the directory containing our models. Notice that you must also pass the path to a working installation of NONMEM, and a default NONMEM version to use.</p>
<p>Note <strong>this only needs to be done once</strong> for each folder you are modeling in. Once the <code>bbi.yaml</code> exists, you will <em>not</em> need to run <code>bbi_init()</code> again unless you want to create another one; for example if you move to modeling in a different directory, or if you want a different set of default settings for some specific subset of models.</p>
</div>
</div>
</div>
<div id="initial-modeling-run" class="section level1">
<h1>Initial modeling run</h1>
<div id="create-model-object" class="section level2">
<h2>Create model object</h2>
<p>To begin modeling, first create a model object using <code>new_model()</code>. This is an S3 object which you will pass to all of the other <code>bbr</code> functions that submit, summarize, or manipulate models.</p>
<p>The first argument (<code>.path</code>) must be the path to your model control stream <em>without file extension</em>. For instance, the call below assumes you have a control stream named <code>1.ctl</code> or <code>1.mod</code> in the directory you just assigned to <code>MODEL_DIR</code> above.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">new_model</span>(<span class="fu">file.path</span>(MODEL_DIR, <span class="dv">1</span>))</span></code></pre></div>
<p>This <code>new_model()</code> call will also create a <code>1.yaml</code> file in that same directory, which stores model metadata like description and tags (discussed below). If you ever need to recreate this model object in memory, just run <code>mod1 &lt;- read_model(file.path(MODEL_DIR, 1))</code> to rebuild it from the YAML file on disk.</p>
<p>The model object you have just created can be passed to various functions which you will see in a minute. Now that we’ve created a model, the first thing we will do is submit the model to be run.</p>
</div>
<div id="submit-model" class="section level2">
<h2>Submit model</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="sc">%&gt;%</span> <span class="fu">submit_model</span>()</span></code></pre></div>
<p>This will return a process object. We won’t discuss this object in this vignette, but it contains some information about the submission call. Please note that <strong>checking on a model run in progress is not fully implemented.</strong> For now, users should check on their runs manually (by looking at the output directory) and only proceed to the next steps once it has successfully completed.</p>
<div id="passing-arguments-to-bbi" class="section level3">
<h3>Passing arguments to bbi</h3>
<p>There are a number of arguments that <code>bbi</code> can take to modify how models are run. You can print a list of available arguments using the <code>print_bbi_args()</code> helper function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_bbi_args</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; additional_post_work_envs (character) -- Any additional values (as ENV KEY=VALUE) to provide for the post execution environment (sets CLI flag `--additional_post_work_envs`)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; background (logical) -- RAW NMFE OPTION - Tells nonmem not to scan StdIn for control characters (sets CLI flag `--background`)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; clean_lvl (numeric) -- clean level used for file output from a given (set of) runs (default 1) (sets CLI flag `--clean_lvl`)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; config (character) -- Path (relative or absolute) to another bbi.yaml to load (sets CLI flag `--config`)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; copy_lvl (numeric) -- copy level used for file output from a given (set of) runs (sets CLI flag `--copy_lvl`)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; debug (logical) -- debug mode (sets CLI flag `--debug`)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; delay (numeric) -- Selects a random number of seconds between 1 and this value to stagger / jitter job execution. Assists in dealing with large volumes of work dealing with the same data set. May avoid NMTRAN issues about not being able read / close files (sets CLI flag `--delay`)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ext_file (character) -- name of custom ext-file (sets CLI flag `--ext-file`)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; git (logical) -- whether git is used (sets CLI flag `--git`)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; json (logical) -- json tree of output, if possible (sets CLI flag `--json`)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; licfile (character) -- RAW NMFE OPTION - Specify a license file to use with NMFE (Nonmem) (sets CLI flag `--licfile`)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; log_file (character) -- If populated, specifies the file into which to store the output / logging details from bbi (sets CLI flag `--log_file`)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; maxlim (numeric) -- RAW NMFE OPTION - Set the maximum values set for the buffers used by Nonmem (default 100) (sets CLI flag `--maxlim`)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mpi_exec_path (character) -- The fully qualified path to mpiexec. Used for nonmem parallel operations (default &#39;/usr/local/mpich3/bin/mpiexec&#39;) (sets CLI flag `--mpi_exec_path`)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; nm_version (character) -- Version of nonmem from the configuration list to use (sets CLI flag `--nm_version`)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; nm_qual (logical) -- Whether or not to execute with nmqual (autolog.pl (sets CLI flag `--nmqual`)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; nobuild (logical) -- RAW NMFE OPTION - Skips recompiling and rebuilding on nonmem executable (sets CLI flag `--nobuild`)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; no_ext_file (logical) -- do not use ext file (sets CLI flag `--no-ext-file`)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; no_grd_file (logical) -- do not use grd file (sets CLI flag `--no-grd-file`)</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; no_shk_file (logical) -- do not use shk file (sets CLI flag `--no-shk-file`)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; overwrite (logical) -- Whether or not to remove existing output directories if they are present (sets CLI flag `--overwrite`)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parafile (character) -- Location of a user-provided parafile to use for parallel execution (sets CLI flag `--parafile`)</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parallel (logical) -- Whether or not to run nonmem in parallel mode (sets CLI flag `--parallel`)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; parallel_timeout (numeric) -- The amount of time to wait for parallel operations in nonmem before timing out (default 2147483647) (sets CLI flag `--parallel_timeout`)</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; post_work_executable (character) -- A script or binary to run when job execution completes or fails (sets CLI flag `--post_work_executable`)</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prcompile (logical) -- RAW NMFE OPTION - Forces PREDPP compilation (sets CLI flag `--prcompile`)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prsame (logical) -- RAW NMFE OPTION - Indicates to nonmem that the PREDPP compilation step should be skipped (sets CLI flag `--prsame`)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; preview (logical) -- preview action, but don&#39;t actually run command (sets CLI flag `--preview`)</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; save_config (logical) -- Whether or not to save the existing configuration to a file with the model (default true) (sets CLI flag `--save_config`)</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; threads (numeric) -- number of threads to execute with (default 4) (sets CLI flag `--threads`)</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; verbose (logical) -- verbose output (sets CLI flag `--verbose`)</span></span></code></pre></div>
<p>As discussed in “Setup” above, these can be set globally in the <code>bbi.yaml</code> file, and you can see the default values of them in that file. However, <strong>specific arguments can also be set or changed for each model.</strong> This can be done in two ways:</p>
<ul>
<li>Attaching them to a model object with <code>add_bbi_args()</code> or <code>replace_bbi_args()</code></li>
<li>Passing them as a named list to the <code>.bbi_args</code> argument of one of the following functions
<ul>
<li><code>new_model()</code> or <code>copy_model_from()</code></li>
<li><code>submit_model()</code> or <code>submit_models()</code></li>
<li><code>model_summary()</code> or <code>model_summaries()</code></li>
</ul></li>
</ul>
<p>Note that any <code>bbi_args</code> attached to a model object will override the relevant settings in <code>bbi.yaml</code>, and that <code>.bbi_args</code> passed into a <code>submit_</code> or <code>_summary</code> call will override the relevant settings in both <code>bbi.yaml</code> <em>and</em> <code>bbi_args</code> attached to the model object.</p>
<p>See the docs for any of the functions just mentioned for more details on usage and syntax.</p>
</div>
<div id="overwriting-output-from-a-previously-run-model" class="section level3">
<h3>Overwriting output from a previously run model</h3>
<p>It is common to run a model, make some tweaks to it, and then run it again. However, to avoid accidentally deleting model outputs, <code>bbr</code> will error by default if it sees existing output when trying to submit a model. To automatically overwrite any previous model output, just pass <code>overwrite = TRUE</code> to the <code>.bbi_args</code> argument described in the previous section. For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="sc">%&gt;%</span> <span class="fu">submit_model</span>(<span class="at">.bbi_args =</span> <span class="fu">list</span>(<span class="at">overwrite =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>You can also change this setting globally by setting <code>overwrite: true</code> in the <code>bbi.yaml</code> file for your project.</p>
</div>
</div>
<div id="summarize-model" class="section level2">
<h2>Summarize model</h2>
<p>Once the model run has completed, users can get a summary object containing much of the commonly used diagnostic information in a named list.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sum1 <span class="ot">&lt;-</span> mod1 <span class="sc">%&gt;%</span> <span class="fu">model_summary</span>()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(sum1))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;absolute_model_path&quot; &quot;run_details&quot;         &quot;run_heuristics&quot;     </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] &quot;parameters_data&quot;     &quot;parameter_names&quot;     &quot;ofv&quot;                </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] &quot;condition_number&quot;    &quot;shrinkage_details&quot;</span></span></code></pre></div>
<p>These elements can be accessed manually or extracted with built-in helper functions like so:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>param_df1 <span class="ot">&lt;-</span> sum1 <span class="sc">%&gt;%</span> <span class="fu">param_estimates</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>param_df1</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 9 × 8</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   parameter_names estimate   stderr random_effect_sd random_effect_sdse fixed</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt; &lt;lgl&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 THETA1            2.32   8.72e- 2           NA              NA        FALSE</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 THETA2           54.6    3.38e+ 0           NA              NA        FALSE</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 THETA3          463.     3.03e+ 1           NA              NA        FALSE</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 THETA4           -0.0820 5.61e- 2           NA              NA        FALSE</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 THETA5            4.18   1.38e+ 0           NA              NA        FALSE</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 OMEGA(1,1)        0.0985 2.03e- 2            0.314           3.24e- 2 FALSE</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 OMEGA(2,1)        0      1   e+10            0               1   e+10 TRUE </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 OMEGA(2,2)        0.157  2.72e- 2            0.396           3.44e- 2 FALSE</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9 SIGMA(1,1)        1      1   e+10            1               1   e+10 TRUE </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2 more variables: diag &lt;lgl&gt;, shrinkage &lt;dbl&gt;</span></span></code></pre></div>
<p>To see how to load summaries of multiple models to an easy-to-read tibble, see the <a href="https://metrumresearchgroup.github.io/bbr/articles/using-summary-log.html">Creating a Model Summary Log</a> vignette.</p>
<p>You can also use the <a href="https://metrumresearchgroup.github.io/bbr/reference/nm_join.html"><code>nm_join()</code></a> function to load the input data and any output tables from your model into a single tibble.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>join_df <span class="ot">&lt;-</span> <span class="fu">nm_join</span>(mod1) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>join_df <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, TIME, DV, CL, V, NPDE, CWRES)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 779 × 7</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       ID  TIME    DV    CL     V  NPDE CWRES</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1  0     1.22  43.4  463. 0.185 0.291</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1  0.25 12.6   43.4  463. 2.47  3.01 </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1  0.5  11.2   43.4  463. 2.71  2.68 </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     1  0.75 17.7   43.4  463. 2.94  4.24 </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     1  1    21.9   43.4  463. 2.94  5.25 </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     1  1.25 16.2   43.4  463. 2.94  3.88 </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     1  1.5  18.7   43.4  463. 2.94  4.47 </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     1  1.75 23.8   43.4  463. 2.94  5.69 </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1  2    16.5   43.4  463. 2.94  3.94 </span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     1  2.25 17.3   43.4  463. 2.94  4.15 </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 769 more rows</span></span></code></pre></div>
</div>
</div>
<div id="iteration" class="section level1">
<h1>Iteration</h1>
<p>Much of the benefit of <code>bbr</code> is leveraged in the model iteration workflow, and the run log summaries that can be created afterwards. For example, imagine you look at these model results and want to begin iterating on them with a new model.</p>
<p>If you are now in a new R session and no longer have your <code>mod1</code> object in memory, you can easily rebuild it from the YAML file on disk with <code>read_model()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">read_model</span>(<span class="fu">file.path</span>(MODEL_DIR, <span class="dv">1</span>))</span></code></pre></div>
<div id="copy_model_from" class="section level2">
<h2>copy_model_from()</h2>
<p>Now you can create a new model object, based on the original, copying and renaming the control stream in the process. By default, the <code>copy_model_from()</code> function will increment the name of the new model to the next available integer in your modeling directory, but you can also pass a custom name to the <code>.new_model</code> argument. See <a href="https://metrumresearchgroup.github.io/bbr/reference/copy_model_from.html"><code>?copy_model_from</code></a> for more details this, and other optional arguments.</p>
<p>The <code>copy_model_from()</code> call below will create both <code>2.ctl</code> and <code>2.yaml</code> files in the same directory as the parent model, and return the model object corresponding to them. (<code>copy_model_from()</code> also stores the model’s “ancestry” which can be useful later in the project, as shown in the <a href="https://metrumresearchgroup.github.io/bbr/articles/using-based-on.html">Using the based_on field</a> vignette.)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">copy_model_from</span>(mod1) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_model_id</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; replacing 1 with 2 in /tmp/RtmpBADrH1/Rinst3e6cbbe8e7/bbr/model/nonmem/basic/2.ctl</span></span></code></pre></div>
<p>The new control stream file <code>2.ctl</code> will be identical to its parent model, though you can use <a href="https://metrumresearchgroup.github.io/bbr/reference/update_model_id.html"><code>update_model_id()</code></a> (as above) to update to the new model ID in places like <code>$TABLE</code> statements.</p>
<p>Your new control stream can now be edited with any desired changes and then submitted and summarized exactly as above. At any time, you can also see the difference between a model and its parent using <a href="https://metrumresearchgroup.github.io/bbr/reference/model_diff.html"><code>model_diff()</code></a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manually edit control stream, then...</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_diff</span>(mod2)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="sc">%&gt;%</span> <span class="fu">submit_model</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>mod2 <span class="sc">%&gt;%</span> <span class="fu">model_summary</span>()</span></code></pre></div>
</div>
<div id="adding-tags-and-notes" class="section level2">
<h2>Adding tags and notes</h2>
<p>After looking at these results, the user can add tags, which can later be used to organize your modeling runs.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> mod1 <span class="sc">%&gt;%</span> <span class="fu">add_tags</span>(<span class="st">&quot;orig acop model&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> mod2 <span class="sc">%&gt;%</span> <span class="fu">add_tags</span>(<span class="st">&quot;2 compartment&quot;</span>)</span></code></pre></div>
<p>Note that using free text for your tags is discouraged, for reasons mentioned in the <code>?modify_tags</code> help page. For simplicity’s sake, we ignore that advice here, but please read it before using tags extensively in the wild.</p>
<p>In addition to tags, the user can add notes that can be referenced later.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> mod2 <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_notes</span>(<span class="st">&quot;2 compartment model more appropriate than 1 compartment&quot;</span>)</span></code></pre></div>
<p>The <code>model_diff()</code> and <code>tags_diff()</code> function make it easy to compare models to their parent model. See the <a href="https://metrumresearchgroup.github.io/bbr/articles/using-based-on.html">“Using based_on” vignette</a> for examples.</p>
</div>
<div id="continue-to-iterate" class="section level2">
<h2>Continue to iterate…</h2>
<p>Now the iteration process continues with a third model. Note that you can tell <code>copy_model_from()</code> to inherit the tags from the parent model and automatically add them to the new model.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">copy_model_from</span>(mod2, <span class="at">.inherit_tags =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Submit and summarize as before.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manually edit control stream, then...</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mod3 <span class="sc">%&gt;%</span> <span class="fu">submit_model</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>mod3 <span class="sc">%&gt;%</span> <span class="fu">model_summary</span>()</span></code></pre></div>
<p>Add tags and notes for filtering in run log, described next.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> mod3 <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_tags</span>(<span class="fu">c</span>(<span class="st">&quot;combined RUV&quot;</span>, <span class="st">&quot;iiv CL&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_notes</span>(<span class="st">&quot;Added combined error structure because it seemed like a good idea&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="run-log" class="section level1">
<h1>Run log</h1>
<p>At any point, the user can easily construct a “run log” tibble to summarize all models run up to this point.</p>
<p>Before we move on, note that you can get even more information about your models from the <code>config_log()</code> and <code>summary_log()</code> functions, as well as <code>add_config()</code> and <code>add_summary()</code> which automatically join the columns output from those functions against the tibble output from <code>run_log()</code>. See the “Further Reading” section below for links to vignettes demonstrating those functions.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="ot">&lt;-</span> <span class="fu">run_log</span>(MODEL_DIR)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>log_df</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 9</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   absolute_model_… run   yaml_md5 model_type description bbi_args based_on tags </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;   &lt;lis&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 /tmp/RtmpBADrH1… 1     c7486e7… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;NULL&gt;   &lt;chr…</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 /tmp/RtmpBADrH1… 2     bc60c6b… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;chr…</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 /tmp/RtmpBADrH1… 3     5a4970e… nonmem     &lt;NA&gt;        &lt;NULL&gt;   &lt;chr [1… &lt;chr…</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1 more variable: notes &lt;list&gt;</span></span></code></pre></div>
<p>The <code>run_log()</code> returns a tibble which can be manipulated like any other tibble. However, several of the columns (<code>tags</code>, <code>notes</code>, and <code>based_on</code> for example) are list columns, which complicates how you can interact with them. We provide some helper functions to more seamlessly interact with these log tibbles, as well as some sample <code>tidyverse</code> code below.</p>
<div id="viewing-tags-example" class="section level2">
<h2>Viewing tags example</h2>
<p>The <code>bbr::collapse_to_string()</code> function can collapse any list column into a string representation of its contents. It is specifically designed for collapsing columns like <code>tags</code>, <code>notes</code>, and <code>based_on</code> into a more human-readable format.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_to_string</span>(tags, notes) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(run, tags, notes)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   run   tags                                notes                               </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                               &lt;chr&gt;                               </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1     orig acop model                     &lt;NA&gt;                                </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 2     2 compartment                       2 compartment model more appropriat…</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 3     2 compartment, combined RUV, iiv CL Added combined error structure beca…</span></span></code></pre></div>
</div>
<div id="filtering-tags-example" class="section level2">
<h2>Filtering tags example</h2>
<p>This code uses <code>purrr::map_lgl</code> to filter the run log to only rows containing a specific tag (<code>&quot;2 compartment&quot;</code>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>log_df <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">map_lgl</span>(tags, <span class="sc">~</span> <span class="st">&quot;2 compartment&quot;</span> <span class="sc">%in%</span> .x)) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_to_string</span>(tags, notes) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(run, tags, notes)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   run   tags                                notes                               </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                               &lt;chr&gt;                               </span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 2     2 compartment                       2 compartment model more appropriat…</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3     2 compartment, combined RUV, iiv CL Added combined error structure beca…</span></span></code></pre></div>
</div>
</div>
<div id="further-reading" class="section level1">
<h1>Further reading</h1>
<p>Hopefully this has given you a good start on understanding the capabilities and basic workflow of <code>bbr</code>. Please see the other vignettes for demonstrations of more advanced or specific functionality.</p>
<ul>
<li><a href="https://metrumresearchgroup.github.io/bbr/articles/using-based-on.html">Using the based_on field</a> – How to use the <code>based_on</code> field to track a model’s ancestry through the model development process, as well as using <code>model_diff()</code> and <code>tags_diff()</code> to compare models. Also demonstrates leveraging <code>config_log()</code> to check whether older models are still up-to-date.</li>
<li><a href="https://metrumresearchgroup.github.io/bbr/articles/using-summary-log.html">Creating a Model Summary Log</a> – How to use <code>summary_log()</code> to extract model diagnostics like the objective function value, condition number, and parameter counts.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
